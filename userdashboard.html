<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard</title>
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="dist/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
</head>
<style>
    .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.1);
    }
    .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
    }
    .navbar-nav .nav-link {
        color: white !important;
        margin-left: 15px;
    }
    .navbar-nav .nav-link i {
        font-size: 1.2rem;
    }
    .user-profile-card, .recharge-details-card {
        background: #FFFFFF;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        padding: 20px;
    }
    .profile-icon {
        font-size: 70px;
        color: #2C3E50;
        padding-left: 10px;
    }
    .settings-icon {
        font-size: 20px;
        color: #000000;
        cursor: pointer;
        position: absolute;
        top: 20px;
        right: 20px;
    }
    .user-tag {
        font-family: 'Pacifico', cursive; 
        font-size: 24px;
        background: linear-gradient(90deg, #ff0ecf, #6f0d86);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* Recharge Details Card */
    .plan-name {
        font-family: 'Montserrat', sans-serif;
        font-size: 18px;
        font-weight: bold;
        color: #2C3E50;
        text-align: center;
    }
    .plan-details {
        font-family: 'Montserrat', sans-serif;
        font-size: 14px;
        color: #34495E;
    }
    .warning-message {
        background: rgba(255, 165, 0, 0.2); 
        color: #FFA500;
        padding: 7px;
        border-radius: 5px;
        font-family: 'Montserrat', sans-serif;
        font-size: 14px;
        text-align: center;
        margin-top: 10px;
    }
    .data-used-heading {
        font-family: 'Montserrat', sans-serif;
        font-size: 14px;
        color: #34495E;
        margin-bottom: 5px;
    }
    .arrow-button {
        background: none;
        border: none;
        color: #000000;
        font-size: 20px;
        cursor: pointer;
    }
    
    .gradient-btn {
        background: transparent;
        color: black;
        letter-spacing: 0.1rem;
        padding: 12px 12px;
        font-size: 10px;
        font-weight: bold;
        text-transform: uppercase;
        cursor: pointer;
        position: relative;
        display: inline-block;
        border-radius: 50px; 
        border: 3px solid transparent; 
        background-image: linear-gradient(white, white), 
                          linear-gradient(90deg, #6a11cb, #c42495);
        background-origin: border-box;
        background-clip: padding-box, border-box; 
        transition: background 0.4s ease-in-out, color 0.4s ease-in-out; 
    }
    .gradient-btn:hover {
        color: white; 
        background-image: linear-gradient(90deg, #6a11cb, #c42495); 
    }

    .rounded-table {
        border-radius: 15px; /* Rounded edges */
        overflow: hidden; /* Ensures the corners are rounded */
    }

    .rounded-table thead th {
        background-color: #834076;
        color: white;
    }

    .rounded-table tbody tr:hover {
        background-color: #f8f9fa;
    }
</style>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand ms-4" href="home.html">ṃȏɞı-ċȏṃṃ</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <!-- Navbar Items -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Plans</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><i class="bi bi-person-circle"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container mt-5 pt-5">
        <div class="text-center mb-4">
            <h1 class="display-4 fw-bold">Welcome Back, Amritha!</h1>
            <p class="lead">Manage your mobile recharges, view plans, and track usage all in one place.</p>
        </div>
        <div class="row mt-5 d-flex">
            <!-- Card 1: User Profile Card -->
            <div class="col-md-4 mb-4 pe-3 d-flex">
                <div class="user-profile-card w-100 h-100">
                    <div class="d-flex">
                        <div>
                            <i class="bi bi-person-circle profile-icon"></i>
                            <!-- Placeholder for user name -->
                            <div id="user-name" class="user-name fs-5 fw-bold mt-2"></div>
                            <!-- Placeholder for user mobile number -->
                            <div id="user-mobile" class="user-number fs-6"></div>
                        </div>
                        <div class="ms-auto">
                            <div id="user-tag" class="user-tag fw-bold">
                                Recharge<br>Guru
                            </div>
                        </div>
                    </div>

                    <!-- Profile Completion -->
                    <div class="mt-4">
                        <div class="fs-6">Profile Completion</div>
                        <div class="progress mt-2">
                            <div class="progress-bar" role="progressbar" style="width: 75%; background: #834076;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>

                    <!-- Tip -->
                    <div class="mt-4">
                        <div class="alert alert-info" style="font-size: 10px;">
                            <i class="bi bi-lightbulb-fill"></i> Tip: Your plan is about to expire. Recharge now to enjoy uninterrupted services!
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 2: Recharge Details Card -->
            <div class="col-md-8 mb-4 ps-3 d-flex">
                <div class="recharge-details-card w-100 h-100">
                    <h5 class="plan-name fs-2">Current Plan</h5>
                    <div class="plan-name">Superdata Pack</div>
                    <div class="d-flex justify-content-between mt-3">
                        <div>
                            <div class="plan-details fs-6">
                                <strong>Data:</strong> 10 GB<br>
                                <strong>Validity:</strong> 30 Days
                            </div>
                        </div>
                        <div>
                            <div class="plan-details fs-6">
                                <strong>Calls:</strong> Unlimited<br>
                                <strong>SMS:</strong> 100/day
                            </div>
                        </div>
                    </div>
                    <div class="data-used-heading mt-3">Data Used</div>
                    <div class="d-flex align-items-center mt-2">
                        <div class="progress flex-grow-1 me-3">
                            <div class="progress-bar" role="progressbar" style="width: 85%; background:#834076;" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div class="plan-details">85%</div>
                    </div>
                    <div class="warning-message mt-3">
                        <i class="bi bi-exclamation-triangle"></i> Plan is about to expire!
                    </div>
                    <div class="d-flex align-items-center justify-content-between mt-3">
                        <div class="text-center flex-grow-1">
                            <button class="gradient-btn">Recharge Now</button>
                        </div>
                        <div>
                            <button class="arrow-button">
                                <i class="bi bi-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Previous Recharges Table -->
    <div class="mt-4 d-flex justify-content-center">
        <div class="table-responsive" style="max-width: 800px; width: 100%;">
            <h5 class="mb-3 text-center">Previous Recharges</h5>
            <table class="table table-bordered table-hover rounded-table mb-5">
                <thead>
                    <tr>
                        <th>Plan Name</th>
                        <th>Validity</th>
                        <th>Price</th>
                        <th>Recharged Date</th>
                        <th>Expired Date</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Super Data Pack</td>
                        <td>30 Days</td>
                        <td>₹299</td>
                        <td>01/10/2023</td>
                        <td>31/10/2023</td>
                    </tr>
                    <tr>
                        <td>Unlimited Calls Pack</td>
                        <td>28 Days</td>
                        <td>₹199</td>
                        <td>15/09/2023</td>
                        <td>13/10/2023</td>
                    </tr>
                    <tr>
                        <td>Night Data Pack</td>
                        <td>15 Days</td>
                        <td>₹99</td>
                        <td>20/08/2023</td>
                        <td>04/09/2023</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light pt-5 pb-4">
        <div class="container">
            <div class="row">
                <!-- About Section -->
                <div class="col-md-3">
                    <h5 class="mb-3 underline">Mobi-Comm</h5>
                    <p class="small">Your trusted mobile recharge platform, providing seamless and secure prepaid recharge services anytime, anywhere.</p>
                    <div>
                        <a href="#" class="me-3"><i class="bi bi-twitter"></i></a>
                        <a href="#" class="me-3"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                    </div>
                </div>
                <!-- Latest News -->
                <div class="col-md-3">
                    <h5 class="mb-3 underline">Latest Offers</h5>
                    <div class="d-flex align-items-center mb-2">
                        <img src="offer1.jpg" class="me-2 rounded" width="50" height="50" alt="Offer">
                        <div>
                            <p class="small mb-1">Get 20% cashback on your first recharge</p>
                            <small>Valid till March 31, 2025</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center pb-4">
                        <img src="offer2.jpg" class="me-2 rounded" width="50" height="50" alt="Offer">
                        <div>
                            <p class="small mb-1">Refer & Earn! Get ₹50 on every successful referral</p>
                            <small>Limited period offer</small>
                        </div>
                    </div>
                </div>
                <!-- Quick Links -->
                <div class="col-md-3">
                    <h5 class="mb-3 underline">Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-light small" style="text-decoration: none;">Home</a></li>
                        <li><a href="#" class="text-light small" style="text-decoration: none;">Prepaid Recharge</a></li>
                        <li><a href="#" class="text-light small" style="text-decoration: none;">DTH Recharge</a></li>
                        <li><a href="#" class="text-light small" style="text-decoration: none;">Bill Payments</a></li>
                        <li><a href="#" class="text-light small" style="text-decoration: none;">Offers & Rewards</a></li>
                        <li><a href="#" class="text-light small" style="text-decoration: none;">Customer Support</a></li>
                    </ul>
                </div>
                <!-- Need Help? -->
                <div class="col-md-3">
                    <h5 class="mb-3 underline">Need Help?</h5>
                    <p class="small"><i class="fas fa-map-marker-alt me-2"></i>123 Recharge Street, New York, USA</p>
                    <p class="small"><i class="fas fa-phone me-2"></i>+1 800 555 6789</p>
                    <p class="small"><i class="fas fa-envelope me-2"></i>support@mobi-comm.com</p>
                </div>
            </div>
            <!-- Copyright -->
            <div class="text-center pt-4 border-top mt-3">
                <p class="small">&copy; 2025 All rights reserved | Made with ❤️ by <a href="home.html" class="text-light" style="text-decoration: none;">Mobi-Comm.com</a></p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

async function fetchUserDetails() {
    const accessToken = localStorage.getItem('accessToken');

    if (!accessToken) {
        window.location.href = '/login.html';
        return;
    }

    try {
        const response = await fetch('http://localhost:8080/userdash/details', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${accessToken}`, 
                'Content-Type': 'application/json',
            },
        });

        if (!response.ok) {
            throw new Error('Failed to fetch user details');
        }

        const userData = await response.json();
        displayUserDetails(userData); // Update the UI with user data
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    }
}

// Function to display user details on the dashboard
function displayUserDetails(userData) {
    // Update user profile card
    document.getElementById('user-name').textContent = userData.name; // Set user name
    document.getElementById('user-mobile').textContent = userData.mobileNumber; // Set mobile number

    // Update other parts of the dashboard if needed
    if (userData.currentPlan) {
        document.getElementById('current-plan-name').textContent = userData.currentPlan.name;
        document.getElementById('current-plan-data').textContent = userData.currentPlan.data;
        document.getElementById('current-plan-validity').textContent = userData.currentPlan.validity;
        document.getElementById('current-plan-calls').textContent = userData.currentPlan.calls;
        document.getElementById('current-plan-sms').textContent = userData.currentPlan.sms;
        document.getElementById('data-used-percentage').textContent = userData.currentPlan.dataUsed;
        document.getElementById('data-used-progress').style.width = userData.currentPlan.dataUsed;
    }

    // Update previous recharges table (if applicable)
    if (userData.previousRecharges && userData.previousRecharges.length > 0) {
        const tableBody = document.querySelector('.rounded-table tbody');
        tableBody.innerHTML = ''; // Clear existing rows

        userData.previousRecharges.forEach(recharge => {
            const row = `
                <tr>
                    <td>${recharge.planName}</td>
                    <td>${recharge.validity}</td>
                    <td>${recharge.price}</td>
                    <td>${recharge.rechargedDate}</td>
                    <td>${recharge.expiredDate}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }
}

// Call fetchUserDetails when the dashboard loads
if (window.location.pathname === '/userdashboard.html') {
    fetchUserDetails();
}
    </script>
</body>
</html>